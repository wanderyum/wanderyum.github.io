<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>./source/2019阿里校招编程测试, 光明小学接力赛路径问题(2)</title>
	<link rel="stylesheet" type="text/css" href="css/native.css">
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {inlineMath: [['$', '$']]},
			messageStyle: "none"});
	</script>
	</head>
<body>
<h1>2019阿里校招编程测试, 光明小学接力赛路径问题(2)</h1>

<h3>题目</h3>

<p>光明小学的小朋友们要举行一年一度的接力跑大赛了，但是小朋友们却遇到了一个难题：设计接力跑大赛的线路，你能帮助他们完成这项工作么？</p>

<p>光明小学可以抽象成一张有N个节点的图，每两点间都有一条道路相连。光明小学的每个班都有M个学生，所以你要为他们设计出一条恰好经过M条边的路径。</p>

<p>光明小学的小朋友们希望全盘考虑所有的因素，所以你需要把任意两点间经过M条边的最短路径的距离输出出来以供参考。</p>

<p>你需要设计这样一个函数：</p>

<div class="codehilite"><pre><span></span><code><span class="n">res</span><span class="p">[][]</span> <span class="n">Solve</span><span class="p">(</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">map</span><span class="p">[][]);</span>
</code></pre></div>

<p><strong>注意：map必然是N * N的二维数组，且map[i][j] == map[j][i]，map[i][i] == 0，-1e8 &lt;= map[i][j] &lt;= 1e8。（道路全部是无向边，无自环）2 &lt;= N &lt;= 100, 2 &lt;= M &lt;= 1e6。要求时间复杂度控制在O(N^3*log(M))。</strong></p>

<p>map数组表示了一张稠密图，其中任意两个不同节点i,j间都有一条边，边的长度为map[i][j]。N表示其中的节点数。</p>

<p>你要返回的数组也必然是一个N * N的二维数组，表示从i出发走到j，经过M条边的最短路径。
你的路径中应考虑包含重复边的情况。</p>

<p>样例:</p>

<div class="codehilite"><pre><span></span><code><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">map</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
<span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">}};</span>
</code></pre></div>

<p>输出结果:</p>

<div class="codehilite"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
<span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">}};</span>
</code></pre></div>

<p>样例解释:</p>

<pre><code>1-&gt;1有两种方法: 1-&gt;2-&gt;1(长度为2+2=4), 1-&gt;3-&gt;1（长度为3+3=6）
2-&gt;2有两种方法: 2-&gt;1-&gt;2(长度为2+2=4), 2-&gt;3-&gt;2（长度为1+1=2）
1-&gt;1有两种方法: 3-&gt;1-&gt;3(长度为3+3=6), 3-&gt;2-&gt;3（长度为1+1=2）
1-&gt;2只有一种方法: 1-&gt;3-&gt;2(长度为3+1=4)
1-&gt;3只有一种方法: 1-&gt;2-&gt;3(长度为2+1=4)
2-&gt;3只有一种方法: 2-&gt;1-&gt;3(长度为2+3=5)
根据对称性可以得到其它部分的答案。
</code></pre>

<h3>思路</h3>

<h4>规范化map</h4>

<p>规范化map主要的好处就是可以将上次得到的约束普遍化。在原始的map里面对起点和终点相同的情况加以惩罚因子, 具体操作就是将起点终点相同的距离设为无穷大, 而不是原来的0。</p>

<h4>构建函数</h4>

<p>程序中需要两个函数:</p>

<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">combineGraph</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>

<p>其中graphForM的作用是获得M个人时的结果, combineGraph在已知n1个人的结果(g1)和n2个人的结果(g2)来得到n1+n2个人的结果的。</p>

<h4>时间复杂度</h4>

<p>外层log(M)次循环, 内层嵌套两层N次的循环外加一个长度为n的遍历, 故时间复杂度为O(log(M)*N^3), 符合题目要求。</p>

<h3>程序</h3>

<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">combineGraph</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">g1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">g2</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">N</span> <span class="ow">in</span> <span class="n">D</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">D</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">tmpg</span> <span class="o">=</span> <span class="n">combineGraph</span><span class="p">(</span><span class="n">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span> <span class="n">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">D</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">combineGraph</span><span class="p">(</span><span class="n">tmpg</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">D</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">combineGraph</span><span class="p">(</span><span class="n">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span> <span class="n">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">))</span>

<span class="n">inf</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">_map</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>

<span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">_map</span><span class="p">:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

<span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span> 
<span class="k">print</span> <span class="n">graphForM</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</code></pre></div>

</body>
</html>